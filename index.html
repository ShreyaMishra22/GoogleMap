<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        /* padding: 5px; */
      }
      #pac-input {
        background-color: #d3dad5;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 400px;
        height: 41px;
        padding: 10p;
        border-radius: 10px;
      }
      #address {
        border: 1px solid #000090;
        background-color: #f0f9ff;
        width: 480px;
        padding-right: 2px;
      }
      #address td {
        font-size: 10pt;
      }
    </style>
  </head>
  <body>
    <input id="pac-input" class="controls" type="text" placeholder="Search Box">
    <!-- <table id="address">
      <tr>
        <td class="label">Street address</td>
        <td class="slimField"><input class="field" id="street_number" disabled="true"/></td>
        <td class="wideField" colspan="2"><input class="field" id="route" disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">City</td>
        <td class="wideField" colspan="3"><input class="field" id="locality" disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">State</td>
        <td class="slimField"><input class="field" id="administrative_area_level_1" disabled="true"/></td>
        <td class="label">Zip code</td>
        <td class="wideField"><input class="field" id="postal_code" disabled="true"/></td>
      </tr>
      <tr>
        <td class="label">Country</td>
        <td class="wideField" colspan="3"><input class="field" id="country" disabled="true"/></td>
      </tr>
    </table> -->
    <div id="map"></div>
    <div id="legend"><h3>Legend</h3></div>
    <script>
      var map, infoWindow;
      function initMap() {
        var directionsService = new google.maps.DirectionsService(); // We do use its service for direction (routes) like one location to other location
        var directionsDisplay = new google.maps.DirectionsRenderer();
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 12,
          mapTypeControlOptions: {
            mapTypeIds: ['coordinate', 'roadmap'],
            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
          }
          // mapTypeControl: false,
          // draggable: false,
          // scaleControl: false,
          // scrollwheel: false,
          // navigationControl: false,
          // streetViewControl: false,
          // mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var ctaLayer = new google.maps.KmlLayer({
          url: 'http://googlemaps.github.io/js-v2-samples/ggeoxml/cta.kml',
          map: map
        });

        // start polyline 
        var flightPlanCoordinates = [
          {lat: 23.302650, lng: 77.390560},
          {lat: 22.665140, lng: 75.916450},
          {lat: 21.810308, lng: 75.800922},
        ];
        var flightPath = new google.maps.Polyline({
          path: flightPlanCoordinates,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });

        flightPath.setMap(map);
        // end polyline 

        // start Top search
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });
        // end Top search


        directionsDisplay.setMap(map);
        infoWindow = new google.maps.InfoWindow;
        // Try HTML5 geolocation.
        console.log('==============', navigator.geolocation);
        if (navigator.geolocation) {
          // fristly here we do also get current location which call geolocationn
          navigator.geolocation.getCurrentPosition(function(position) {
            console.log('position============', position)
            // var pos = {
            //   lat: position.coords.latitude,
            //   lng: position.coords.longitude
            // };
            // var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/'; it use for default google map icon
            var iconBase = 'file:///home/admin1/projects/basic-google-map/icon/'; //it use for custom icon
            var multipalLoaction = [
              {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                icon: iconBase + 'medic-suitcase.png',
                population: 100
              },
              {
                lat: 22.738020,
                lng: 75.879350,
                icon: iconBase + 'aeroplane.png',
                population: 80
              },
              {
                lat: 22.767179,
                lng: 75.671928,
                icon: iconBase + 'subway-sign.png',
                population: 800
              },
              {
                lat: 22.718670,
                lng: 75.855710,
                icon: iconBase + 'pharmacy-cross-sign.png',
                population: 70
              },
              {
                lat: 22.810308,
                lng: 75.800922,
                icon: iconBase + 'ltblue-dot.png',
                population: 500
              },              
            ]

            var bounds = {
            north: 44.599,
            south: 44.490,
            east: -78.443,
            west: -78.649
          };

          // Define a rectangle and set its editable property to true.
          var rectangle = new google.maps.Rectangle({
            bounds: bounds,
            editable: true
          });
          rectangle.setMap(map);

            // Here is start show papulation
            for (var city in multipalLoaction) {
              // Add the circle for this city to the map.
              var cityCircle = new google.maps.Circle({
                strokeColor: 'skyblue',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: 'skyblue',
                fillOpacity: 0.35,
                map: map,
                center: multipalLoaction[city],
                radius: Math.sqrt(multipalLoaction[city].population) * 100
              });
            }
            // Here is end show papulation
          
            var triangleCoords = multipalLoaction
            // Construct the polygon.
            var bermudaTriangle = new google.maps.Polygon({
              paths: [triangleCoords, triangleCoords],
              strokeColor: 'yellow',
              strokeOpacity: 0.8,
              strokeWeight: 2,
              fillColor: '#FF0000',
              fillOpacity: 0.35,
              draggable: true,
              geodesic: true
            });
            bermudaTriangle.setMap(map);

          
            var firstTimeShowAddress = true;
            var i = 0;
            var geocoder = new google.maps.Geocoder;
                var infowindow = new google.maps.InfoWindow;
            var legend = document.getElementById('legend');
            multipalLoaction.forEach(function (pos) {
              let markericon = pos.icon
              delete pos.icon;
                map.setCenter(pos);
                var marker = new google.maps.Marker({
                  position: pos,
                  map: map,
                  icon: markericon,
                });

                if (firstTimeShowAddress) {
                  firstTimeShowAddress = false;
                    // geocoder.geocode({'address': address}, function(results, status) { we wcan get latitude and longlatitude by  address 
                    geocoder.geocode({'location': pos}, function(results, status) {
                      position = null
                      // console.log(status, 'formatted_address===========', results[0]);
                      if (status === 'OK' && results[0].formatted_address) {
                        if (results[0]) {
                          var marker = new google.maps.Marker({
                            position: pos,
                            map: map,
                          });
                          infowindow.setContent(results[0].formatted_address);
                          infowindow.open(map, marker);
                        } else {
                          window.alert('No results found');
                        }
                      } else {
                        window.alert('Geocoder failed due to: ' + status);
                      }
                  });
                }

                // here is show address deatils if click marker
                google.maps.event.addListener(marker, 'click', (function(marker, i) {
                  return function() {
                      geocoder.geocode({'location': multipalLoaction[i]}, function(results, status) {
                        position = null
                        if (status === 'OK' && results[0].formatted_address) {
                          if (results[0]) {
                            var marker = new google.maps.Marker({
                              position: multipalLoaction[i],
                              map: map,
                            });
                            infowindow.setContent(results[0].formatted_address);
                            infowindow.open(map, marker);
                          } else {
                            window.alert('No results found');
                          }
                        } else {
                          window.alert('Geocoder failed due to: ' + status);
                        }
                    });
                  }
                })(marker, i));
                let name = 'Library';
                let icon = markericon;
                let div = document.createElement('div');
                div.innerHTML = '<img src="' + icon + '"> ' + name;
                legend.appendChild(div);
               i++                
            })
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);

          // start routes 
            calcRoute();
            // here is show start and end direction
            function calcRoute() {
              var start = multipalLoaction[0];
              var end = multipalLoaction[4];
              var request = {
                origin: start,
                destination: end,
                travelMode: 'DRIVING'
              };
              directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                  directionsDisplay.setDirections(result);
                }
              });
            }
          // end routes 

          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

     
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcuvfluXN4RIhVdsZ6jQCMmDOR74Q6miE&libraries=places&callback=initMap"
    async defer></script>
  </body>
</html> 